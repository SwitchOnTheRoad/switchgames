<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Admin — Switch</title>
    <meta name="robots" content="noindex, nofollow"/>
    <link rel="icon" type="image/png" href="/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #FBBF24;
            --bg: #0A0A0A;
            --surface: #111111;
            --surface-mid: #181818;
            --border: #242424;
            --text: #F5F5F5;
            --muted: #808080;
            --danger: #ef4444;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; overflow: hidden; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); font-size: 14px; }
        h1, h2, h3, h4 { font-family: 'Space Grotesk', sans-serif; font-weight: 700; line-height: 1.2; }

        /* ═══════════════════════════════════════
           LOGIN
        ═══════════════════════════════════════ */
        #login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--bg);
        }

        .login-card {
            width: 100%;
            max-width: 360px;
            padding: 0 1.5rem;
        }

        .login-logo {
            height: 32px;
            display: block;
            margin: 0 auto 3rem;
        }

        .login-eyebrow {
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--primary);
            display: block;
            margin-bottom: 0.5rem;
        }

        .login-title {
            font-size: 1.75rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 2rem;
        }

        .login-field {
            margin-bottom: 0.75rem;
        }

        .login-field input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            outline: none;
            transition: border-color 0.15s;
            border-radius: 0;
        }

        .login-field input:focus { border-color: var(--primary); }
        .login-field input::placeholder { color: #3a3a3a; }

        .login-error {
            display: none;
            background: rgba(239,68,68,0.06);
            border: 1px solid rgba(239,68,68,0.2);
            color: #f87171;
            padding: 0.625rem 1rem;
            font-size: 0.8rem;
            margin-bottom: 0.75rem;
        }

        /* ═══════════════════════════════════════
           APP SHELL — 3 COLUMN
        ═══════════════════════════════════════ */
        #app { display: none; height: 100vh; flex-direction: row; }

        /* ── LEFT RAIL (section switcher) ── */
        .rail {
            width: 220px;
            flex-shrink: 0;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .rail-header {
            padding: 1.5rem 1.5rem 1.25rem;
            border-bottom: 1px solid var(--border);
        }

        .rail-logo {
            height: 28px;
            display: block;
            margin-bottom: 0.875rem;
        }

        .rail-badge {
            display: inline-flex;
            align-items: center;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--primary);
            background: rgba(251,191,36,0.08);
            border: 1px solid rgba(251,191,36,0.2);
            padding: 2px 8px;
        }

        .rail-nav {
            padding: 0.75rem 0;
            flex: 1;
        }

        .rail-label {
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            color: var(--muted);
            padding: 0 1.25rem;
            margin: 0.75rem 0 0.375rem;
            display: block;
        }

        .rail-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.65rem 1.25rem;
            color: var(--muted);
            font-size: 0.825rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
            transition: color 0.12s, background 0.12s;
            border-left: 2px solid transparent;
            font-family: 'Inter', sans-serif;
        }

        .rail-link:hover { color: var(--text); background: var(--surface-mid); }
        .rail-link.active { color: var(--primary); border-left-color: var(--primary); background: rgba(251,191,36,0.05); }

        .rail-link svg { flex-shrink: 0; opacity: 0.6; }
        .rail-link.active svg { opacity: 1; color: var(--primary); }

        .rail-unread {
            margin-left: auto;
            background: var(--primary);
            color: #000;
            font-size: 0.6rem;
            font-weight: 800;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
        }

        .rail-footer {
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        /* ── LIST PANEL ── */
        .list-panel {
            width: 320px;
            flex-shrink: 0;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg);
        }

        .list-panel-head {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            flex-shrink: 0;
        }

        .list-panel-title {
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            color: var(--muted);
        }

        .list-search {
            padding: 0.75rem 1.5rem;
            border-bottom: 1px solid var(--border);
            position: relative;
            flex-shrink: 0;
        }

        .list-search input {
            width: 100%;
            padding: 0.55rem 0.875rem 0.55rem 2.25rem;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            outline: none;
            transition: border-color 0.15s;
        }

        .list-search input::placeholder { color: #3a3a3a; }
        .list-search input:focus { border-color: var(--primary); }

        .list-search-icon {
            position: absolute;
            left: 2.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: #3a3a3a;
            pointer-events: none;
        }

        .list-items {
            flex: 1;
            overflow-y: auto;
        }

        .list-items::-webkit-scrollbar { width: 3px; }
        .list-items::-webkit-scrollbar-thumb { background: var(--border); }

        /* Career-page-style list items */
        .list-item {
            padding: 1.125rem 1.5rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.12s;
            border-left: 3px solid transparent;
        }

        .list-item:hover { background: var(--surface); }
        .list-item.active { background: var(--surface); border-left-color: var(--primary); }

        .list-item-name {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--muted);
            margin-bottom: 0.4rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.12s;
        }

        .list-item.active .list-item-name { color: var(--primary); }

        .list-item-tags {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .item-tag {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
        }

        .item-tag::before { content: '·'; margin-right: 0.3rem; color: var(--border); }
        .item-tag:first-child::before { display: none; }
        .item-tag.primary { color: var(--primary); }

        .tag-pill {
            display: inline-flex;
            align-items: center;
            padding: 1px 6px;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .pill-live { background: rgba(34,197,94,0.08); color: #4ade80; border: 1px solid rgba(34,197,94,0.18); }
        .pill-draft { background: var(--surface); color: var(--muted); border: 1px solid var(--border); }
        .pill-featured { background: rgba(251,191,36,0.08); color: var(--primary); border: 1px solid rgba(251,191,36,0.18); }

        .list-empty {
            padding: 3.5rem 1.5rem;
            text-align: center;
            color: var(--muted);
            font-size: 0.8rem;
            line-height: 1.8;
        }

        /* ── SECTION VISIBILITY ── */
        .section { display: none; width: 100%; }
        .section.active { display: flex; }

        /* ── DETAIL / EDITOR PANEL ── */
        .detail-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .detail-empty {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--muted);
            text-align: center;
            padding: 4rem 2rem;
            gap: 1rem;
        }

        .detail-empty svg { opacity: 0.12; }
        .detail-empty p { font-size: 0.875rem; }

        .detail-form {
            display: none;
            flex: 1;
            flex-direction: column;
            overflow: hidden;
        }

        /* Toolbar at top of editor */
        .detail-toolbar {
            padding: 0.875rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: var(--surface);
            flex-shrink: 0;
        }

        .toolbar-spacer { flex: 1; }
        .toolbar-sep { width: 1px; height: 18px; background: var(--border); margin: 0 0.125rem; }

        /* Scrollable form body */
        .detail-body {
            flex: 1;
            overflow-y: auto;
            padding: 2.5rem 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.75rem;
        }

        .detail-body::-webkit-scrollbar { width: 4px; }
        .detail-body::-webkit-scrollbar-thumb { background: var(--border); }

        /* ── FORM FIELDS ── */
        .field-label {
            font-size: 0.63rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            color: var(--muted);
            display: block;
            margin-bottom: 0.5rem;
        }

        .field-input,
        .field-textarea,
        .field-select {
            width: 100%;
            padding: 0.7rem 0.875rem;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            outline: none;
            transition: border-color 0.15s;
        }

        .field-input:focus, .field-textarea:focus, .field-select:focus { border-color: var(--primary); }
        .field-input::placeholder, .field-textarea::placeholder { color: #383838; }
        .field-textarea { resize: vertical; }
        .field-select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%23808080' stroke-width='2.5'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.75rem center; padding-right: 2rem; cursor: pointer; }

        /* Big title input (blog) */
        .title-input {
            width: 100%;
            padding: 0.5rem 0;
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--border);
            color: var(--text);
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            outline: none;
            transition: border-color 0.15s;
        }
        .title-input:focus { border-color: var(--primary); }
        .title-input::placeholder { color: #2a2a2a; }

        /* Grid row */
        .field-row {
            display: grid;
            gap: 1rem;
        }

        .field-row-3 { grid-template-columns: 1fr 1fr 1fr; }
        .field-row-2 { grid-template-columns: 1fr 1fr; }

        /* Section divider inside form */
        .form-section {
            display: flex;
            flex-direction: column;
            gap: 0.875rem;
        }

        .form-section-label {
            font-size: 0.63rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            color: var(--primary);
            display: block;
            padding-bottom: 0.625rem;
            border-bottom: 1px solid var(--border);
        }

        /* Dynamic list (requirements, etc.) */
        .dyn-list { display: flex; flex-direction: column; gap: 0.5rem; }

        .dyn-item {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .dyn-item .field-input { flex: 1; }

        .dyn-remove {
            width: 32px;
            height: 36px;
            flex-shrink: 0;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: border-color 0.12s, color 0.12s;
        }

        .dyn-remove:hover { border-color: var(--danger); color: var(--danger); }

        .add-item-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            background: transparent;
            border: 1px dashed var(--border);
            color: var(--muted);
            font-family: 'Inter', sans-serif;
            font-size: 0.78rem;
            font-weight: 600;
            padding: 0.5rem 0.875rem;
            cursor: pointer;
            transition: border-color 0.12s, color 0.12s;
            align-self: flex-start;
        }

        .add-item-btn:hover { border-color: var(--primary); color: var(--primary); }

        /* Thumbnail preview */
        .thumb-wrap { display: flex; flex-direction: column; gap: 0.75rem; }

        .thumb-preview {
            width: 100%;
            aspect-ratio: 16/9;
            background: var(--surface);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            max-width: 360px;
        }

        .thumb-preview img { width: 100%; height: 100%; object-fit: cover; }
        .thumb-preview-ph { font-size: 0.78rem; color: #3a3a3a; }

        /* Toggle checkbox row */
        .toggle-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--muted);
            cursor: pointer;
            padding: 0.4rem 0.75rem;
            border: 1px solid var(--border);
            transition: all 0.12s;
            user-select: none;
        }

        .toggle-row:hover { border-color: #3a3a3a; color: var(--text); }
        .toggle-row input[type=checkbox] { accent-color: var(--primary); width: 13px; height: 13px; cursor: pointer; }

        /* ── BUTTONS ── */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            padding: 0.5rem 1.125rem;
            border: none;
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.12s;
            white-space: nowrap;
            text-decoration: none;
            letter-spacing: 0.01em;
        }

        .btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .btn-primary { background: var(--primary); color: #000; }
        .btn-primary:hover:not(:disabled) { background: #E5A800; }

        .btn-ghost { background: transparent; color: var(--muted); border: 1px solid var(--border); }
        .btn-ghost:hover { color: var(--text); border-color: #3a3a3a; }

        .btn-danger { background: transparent; color: var(--danger); border: 1px solid rgba(239,68,68,0.2); }
        .btn-danger:hover { background: rgba(239,68,68,0.06); border-color: rgba(239,68,68,0.4); }

        .btn-upload { background: var(--surface); color: var(--muted); border: 1px solid var(--border); cursor: pointer; }
        .btn-upload:hover { border-color: var(--primary); color: var(--primary); }

        /* ── TOAST ── */
        .toast {
            position: fixed;
            bottom: 1.75rem;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 0.6rem 1.25rem;
            font-size: 0.8rem;
            font-weight: 500;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s, transform 0.2s;
            white-space: nowrap;
        }

        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .toast.success { border-color: rgba(251,191,36,0.3); color: var(--primary); }
        .toast.error { border-color: rgba(239,68,68,0.3); color: #f87171; }

        /* ── CONFIRM DIALOG ── */
        .confirm-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.75);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .confirm-overlay.open { display: flex; }

        .confirm-box {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 2rem;
            max-width: 360px;
            width: 100%;
            margin: 1rem;
        }

        .confirm-title { font-size: 1.1rem; margin-bottom: 0.625rem; }
        .confirm-body { color: var(--muted); font-size: 0.875rem; margin-bottom: 2rem; line-height: 1.7; }
        .confirm-actions { display: flex; gap: 0.625rem; justify-content: flex-end; }

        /* ── QUILL OVERRIDES ── */
        .ql-toolbar.ql-snow {
            border: 1px solid var(--border);
            border-bottom: none;
            background: var(--surface);
        }

        .ql-container.ql-snow {
            border: 1px solid var(--border);
            background: var(--bg);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            color: var(--text);
            min-height: 240px;
        }

        .ql-editor { color: var(--text); min-height: 220px; }
        .ql-editor.ql-blank::before { color: #383838; font-style: normal; }
        .ql-snow .ql-stroke { stroke: var(--muted); }
        .ql-snow .ql-fill { fill: var(--muted); }
        .ql-snow .ql-picker { color: var(--muted); }
        .ql-snow .ql-picker-options { background: var(--surface); border-color: var(--border); }
        .ql-snow .ql-picker-item { color: var(--muted); }
        .ql-snow .ql-picker-item:hover, .ql-snow .ql-picker-label:hover { color: var(--primary); }
        .ql-snow button:hover .ql-stroke, .ql-snow .ql-active .ql-stroke { stroke: var(--primary); }
        .ql-snow button:hover .ql-fill, .ql-snow .ql-active .ql-fill { fill: var(--primary); }
        .ql-snow .ql-tooltip { background: var(--surface); border-color: var(--border); color: var(--text); box-shadow: none; }
        .ql-snow .ql-tooltip input[type=text] { background: var(--bg); border: 1px solid var(--border); color: var(--text); outline: none; }
        .ql-snow .ql-tooltip a.ql-action::after { color: var(--primary); }
    </style>
</head>
<body>

<!-- ═══════════════════════════════════════
     LOGIN SCREEN
═══════════════════════════════════════ -->
<div id="login-screen">
    <div class="login-card">
        <img src="/logo.png" alt="Switch" class="login-logo">
        <span class="login-eyebrow">Restricted Access</span>
        <h1 class="login-title">Admin Panel</h1>
        <div class="login-field">
            <input type="password" id="login-input" placeholder="Enter password" autocomplete="current-password">
        </div>
        <div class="login-error" id="login-error">Incorrect password. Try again.</div>
        <button class="btn btn-primary" id="login-btn" style="width:100%;padding:0.75rem;font-size:0.875rem;">Sign In</button>
    </div>
</div>

<!-- ═══════════════════════════════════════
     APP
═══════════════════════════════════════ -->
<div id="app" style="display:none;flex-direction:row;height:100vh;">

    <!-- RAIL -->
    <aside class="rail">
        <div class="rail-header">
            <img src="/logo.png" alt="Switch" class="rail-logo">
            <span class="rail-badge">Admin</span>
        </div>
        <nav class="rail-nav">
            <span class="rail-label">Content</span>
            <button class="rail-link active" data-tab="games">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
                Games
            </button>
            <button class="rail-link" data-tab="blog">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                Blog
            </button>
            <button class="rail-link" data-tab="careers">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>
                Careers
            </button>
            <span class="rail-label" style="margin-top:1.5rem;">Inbox</span>
            <button class="rail-link" data-tab="messages">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                Messages
                <span class="rail-unread" id="rail-unread-messages" style="display:none"></span>
            </button>
            <button class="rail-link" data-tab="applications">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                Applications
                <span class="rail-unread" id="rail-unread-applications" style="display:none"></span>
            </button>
        </nav>
        <div class="rail-footer">
            <a href="/" target="_blank" class="btn btn-ghost" style="justify-content:flex-start;font-size:0.78rem;gap:0.5rem;">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                View Site
            </a>
            <button class="btn btn-ghost" id="logout-btn" style="justify-content:flex-start;font-size:0.78rem;">Sign Out</button>
        </div>
    </aside>

    <!-- ═══ GAMES SECTION ═══ -->
    <div class="section active" id="section-games">
        <div class="list-panel">
            <div class="list-panel-head">
                <span class="list-panel-title">Games</span>
                <button class="btn btn-primary" id="new-game-btn" style="font-size:0.75rem;padding:0.375rem 0.875rem;">+ New</button>
            </div>
            <div class="list-items" id="games-list">
                <div class="list-empty">Loading…</div>
            </div>
        </div>
        <div class="detail-panel">
            <div class="detail-empty" id="game-empty">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
                <p>Select a game or create a new one</p>
            </div>
            <div class="detail-form" id="game-form">
                <div class="detail-toolbar">
                    <button class="btn btn-primary" id="save-game-btn">
                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Save
                    </button>
                    <label class="toggle-row">
                        <input type="checkbox" id="game-active"> Active
                    </label>
                    <label class="toggle-row">
                        <input type="checkbox" id="game-featured"> Featured
                    </label>
                    <div class="toolbar-spacer"></div>
                    <button class="btn btn-danger" id="delete-game-btn">Delete</button>
                </div>
                <div class="detail-body">
                    <div>
                        <label class="field-label">Place ID *</label>
                        <input class="field-input" type="number" id="game-place-id" placeholder="e.g. 88967358637066">
                    </div>
                    <div>
                        <label class="field-label">Thumbnail</label>
                        <div class="thumb-wrap">
                            <div class="thumb-preview" id="game-thumb-preview">
                                <span class="thumb-preview-ph">No image uploaded</span>
                            </div>
                            <label class="btn btn-upload" style="align-self:flex-start;cursor:pointer;">
                                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                Upload Image
                                <input type="file" id="game-img-input" accept="image/*" style="display:none">
                            </label>
                            <input type="hidden" id="game-thumb-url">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══ BLOG SECTION ═══ -->
    <div class="section" id="section-blog">
        <div class="list-panel">
            <div class="list-panel-head">
                <span class="list-panel-title">Posts</span>
                <button class="btn btn-primary" id="new-post-btn" style="font-size:0.75rem;padding:0.375rem 0.875rem;">+ New</button>
            </div>
            <div class="list-search">
                <svg class="list-search-icon" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                <input type="text" id="blog-search" placeholder="Search posts…">
            </div>
            <div class="list-items" id="posts-list">
                <div class="list-empty">Loading…</div>
            </div>
        </div>
        <div class="detail-panel">
            <div class="detail-empty" id="blog-empty">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                <p>Select a post or create a new one</p>
            </div>
            <div class="detail-form" id="blog-form">
                <div class="detail-toolbar">
                    <button class="btn btn-primary" id="save-post-btn">
                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Save
                    </button>
                    <label class="toggle-row">
                        <input type="checkbox" id="post-publish"> Published
                    </label>
                    <div class="toolbar-sep"></div>
                    <label class="btn btn-upload" style="cursor:pointer;">
                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                        Insert Image
                        <input type="file" id="blog-img-input" accept="image/*" style="display:none">
                    </label>
                    <div class="toolbar-spacer"></div>
                    <button class="btn btn-danger" id="delete-post-btn">Delete</button>
                </div>
                <div class="detail-body">
                    <input class="title-input" type="text" id="post-title" placeholder="Post title…">
                    <div id="quill-editor"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══ CAREERS SECTION ═══ -->
    <div class="section" id="section-careers">
        <div class="list-panel">
            <div class="list-panel-head">
                <span class="list-panel-title">Positions</span>
                <button class="btn btn-primary" id="new-career-btn" style="font-size:0.75rem;padding:0.375rem 0.875rem;">+ New</button>
            </div>
            <div class="list-search">
                <svg class="list-search-icon" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                <input type="text" id="career-search" placeholder="Search positions…">
            </div>
            <div class="list-items" id="careers-list">
                <div class="list-empty">Loading…</div>
            </div>
        </div>
        <div class="detail-panel">
            <div class="detail-empty" id="career-empty">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>
                <p>Select a position or create a new one</p>
            </div>
            <div class="detail-form" id="career-form">
                <div class="detail-toolbar">
                    <button class="btn btn-primary" id="save-career-btn">
                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        Save
                    </button>
                    <label class="toggle-row">
                        <input type="checkbox" id="career-active"> Active
                    </label>
                    <div class="toolbar-spacer"></div>
                    <button class="btn btn-danger" id="delete-career-btn">Delete</button>
                </div>
                <div class="detail-body">
                    <!-- Basic info -->
                    <div>
                        <label class="field-label">Job Title *</label>
                        <input class="field-input" type="text" id="career-title" placeholder="e.g. Senior UI Developer">
                    </div>
                    <div class="field-row field-row-3">
                        <div>
                            <label class="field-label">Department</label>
                            <input class="field-input" type="text" id="career-dept" placeholder="e.g. Engineering">
                        </div>
                        <div>
                            <label class="field-label">Type</label>
                            <select class="field-select" id="career-type">
                                <option>Full-time</option>
                                <option>Part-time</option>
                                <option>Contract</option>
                                <option>Volunteer</option>
                                <option>Internship</option>
                            </select>
                        </div>
                        <div>
                            <label class="field-label">Location</label>
                            <input class="field-input" type="text" id="career-location" placeholder="e.g. Remote">
                        </div>
                    </div>
                    <div>
                        <label class="field-label">Description</label>
                        <textarea class="field-textarea" id="career-desc" rows="4" placeholder="What will this person be doing?"></textarea>
                    </div>

                    <!-- Requirements -->
                    <div class="form-section">
                        <span class="form-section-label">Requirements</span>
                        <div class="dyn-list" id="req-list"></div>
                        <button class="add-item-btn" id="add-req">+ Add requirement</button>
                    </div>

                    <!-- Nice to have -->
                    <div class="form-section">
                        <span class="form-section-label">Nice to Have</span>
                        <div class="dyn-list" id="nice-list"></div>
                        <button class="add-item-btn" id="add-nice">+ Add nice-to-have</button>
                    </div>

                    <!-- Questions -->
                    <div class="form-section">
                        <span class="form-section-label">Application Questions</span>
                        <div class="dyn-list" id="q-list"></div>
                        <button class="add-item-btn" id="add-q">+ Add question</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══ MESSAGES SECTION ═══ -->
    <div class="section" id="section-messages">
        <div class="list-panel">
            <div class="list-panel-head">
                <span class="list-panel-title">Messages</span>
                <span class="list-panel-count" id="messages-count" style="font-size:0.7rem;color:var(--muted);"></span>
            </div>
            <div class="list-search">
                <svg class="list-search-icon" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                <input type="text" id="messages-search" placeholder="Search messages…">
            </div>
            <div class="list-items" id="messages-list">
                <div class="list-empty">Loading…</div>
            </div>
        </div>
        <div class="detail-panel">
            <div class="detail-empty" id="message-empty">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                <p>Select a message to read it</p>
            </div>
            <div class="detail-form" id="message-detail" style="display:none;flex:1;flex-direction:column;overflow:hidden;">
                <div class="detail-toolbar">
                    <div class="toolbar-spacer"></div>
                    <button class="btn btn-danger" id="delete-message-btn">Delete</button>
                </div>
                <div class="detail-body" id="message-body-wrap"></div>
            </div>
        </div>
    </div>

    <!-- ═══ APPLICATIONS SECTION ═══ -->
    <div class="section" id="section-applications">
        <div class="list-panel">
            <div class="list-panel-head">
                <span class="list-panel-title">Applications</span>
                <span class="list-panel-count" id="applications-count" style="font-size:0.7rem;color:var(--muted);"></span>
            </div>
            <div class="list-search">
                <svg class="list-search-icon" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                <input type="text" id="applications-search" placeholder="Search applicants…">
            </div>
            <div class="list-items" id="applications-list">
                <div class="list-empty">Loading…</div>
            </div>
        </div>
        <div class="detail-panel">
            <div class="detail-empty" id="application-empty">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                <p>Select an application to review it</p>
            </div>
            <div class="detail-form" id="application-detail" style="display:none;flex:1;flex-direction:column;overflow:hidden;">
                <div class="detail-toolbar">
                    <select class="field-select" id="app-status-select" style="width:auto;padding:0.4rem 2rem 0.4rem 0.75rem;font-size:0.8rem;">
                        <option value="new">New</option>
                        <option value="reviewing">Reviewing</option>
                        <option value="shortlisted">Shortlisted</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <button class="btn btn-primary" id="save-app-status-btn">Save Status</button>
                    <div class="toolbar-spacer"></div>
                    <button class="btn btn-danger" id="delete-application-btn">Delete</button>
                </div>
                <div class="detail-body" id="application-body-wrap"></div>
            </div>
        </div>
    </div>

</div><!-- /app -->

<!-- CONFIRM DIALOG -->
<div class="confirm-overlay" id="confirm-overlay">
    <div class="confirm-box">
        <h3 class="confirm-title" id="confirm-title">Are you sure?</h3>
        <p class="confirm-body" id="confirm-body">This action cannot be undone.</p>
        <div class="confirm-actions">
            <button class="btn btn-ghost" id="confirm-cancel">Cancel</button>
            <button class="btn btn-danger" id="confirm-ok">Delete</button>
        </div>
    </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js"></script>
<script>
// ── STATE ──────────────────────────────────────────────────────────────────
let token = sessionStorage.getItem('sw_token');
let posts = [], careers = [], games = [];
let activePostId = null, activeCareerId = null, activeGameId = null;
let quill = null;

// ── UTILS ──────────────────────────────────────────────────────────────────
function fmtDate(iso) {
    if (!iso) return '—';
    return new Date(iso).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
}

let toastTimer;
function toast(msg, type = 'success') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = `toast ${type} show`;
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => t.className = 'toast', 2500);
}

function confirm(title, body, onOk) {
    document.getElementById('confirm-title').textContent = title;
    document.getElementById('confirm-body').textContent = body;
    document.getElementById('confirm-overlay').classList.add('open');
    const ok = document.getElementById('confirm-ok');
    const cancel = document.getElementById('confirm-cancel');
    const close = () => document.getElementById('confirm-overlay').classList.remove('open');
    ok.onclick = () => { close(); onOk(); };
    cancel.onclick = close;
}

// ── LOGIN ──────────────────────────────────────────────────────────────────
function showApp() {
    document.getElementById('login-screen').style.display = 'none';
    const app = document.getElementById('app');
    app.style.display = 'flex';
    initQuill();
    loadGames(); loadPosts(); loadCareers(); loadMessages(); loadApplications();
}

if (token) showApp();

async function doLogin() {
    const pw = document.getElementById('login-input').value;
    const err = document.getElementById('login-error');
    if (!pw) return;
    try {
        const res = await fetch('/api/admin/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ password: pw }) });
        const d = await res.json();
        if (!res.ok) { err.style.display = 'block'; return; }
        token = d.token;
        sessionStorage.setItem('sw_token', token);
        err.style.display = 'none';
        showApp();
    } catch { err.style.display = 'block'; }
}

document.getElementById('login-btn').addEventListener('click', doLogin);
document.getElementById('login-input').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });

document.getElementById('logout-btn').addEventListener('click', async () => {
    await fetch('/api/admin/logout', { method: 'POST', headers: { 'x-admin-token': token } });
    sessionStorage.removeItem('sw_token');
    location.reload();
});

// ── RAIL NAV ───────────────────────────────────────────────────────────────
document.querySelectorAll('.rail-link[data-tab]').forEach(link => {
    link.addEventListener('click', () => {
        document.querySelectorAll('.rail-link').forEach(l => l.classList.remove('active'));
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        link.classList.add('active');
        document.getElementById(`section-${link.dataset.tab}`).classList.add('active');
    });
});

// ── QUILL ──────────────────────────────────────────────────────────────────
function initQuill() {
    quill = new Quill('#quill-editor', {
        theme: 'snow',
        placeholder: 'Write your post…',
        modules: {
            toolbar: [
                [{ header: [1, 2, 3, false] }],
                ['bold', 'italic', 'underline'],
                [{ list: 'ordered' }, { list: 'bullet' }],
                ['blockquote', 'link'],
                ['clean']
            ]
        }
    });
}

// ── IMAGE UPLOAD ───────────────────────────────────────────────────────────
async function uploadImage(file) {
    const fd = new FormData(); fd.append('image', file);
    const res = await fetch('/api/admin/upload', { method: 'POST', headers: { 'x-admin-token': token }, body: fd });
    const d = await res.json();
    if (!res.ok) throw new Error(d.message || 'Upload failed');
    return d.url;
}

document.getElementById('blog-img-input').addEventListener('change', async e => {
    const file = e.target.files[0]; if (!file) return;
    try {
        const url = await uploadImage(file);
        const idx = quill.getSelection(true)?.index ?? quill.getLength();
        quill.insertEmbed(idx, 'image', url);
        toast('Image inserted');
    } catch (err) { toast(err.message, 'error'); }
    e.target.value = '';
});

document.getElementById('game-img-input').addEventListener('change', async e => {
    const file = e.target.files[0]; if (!file) return;
    try {
        const url = await uploadImage(file);
        document.getElementById('game-thumb-url').value = url;
        document.getElementById('game-thumb-preview').innerHTML = `<img src="${url}">`;
        toast('Thumbnail uploaded');
    } catch (err) { toast(err.message, 'error'); }
    e.target.value = '';
});

// ── UNREAD BADGE HELPER ────────────────────────────────────────────────────
function updateUnreadBadge(id, items) {
    const badge = document.getElementById(`rail-unread-${id}`);
    if (!badge) return;
    const count = items.filter(i => !i.read).length;
    if (count > 0) { badge.style.display = 'inline-flex'; badge.textContent = count; }
    else { badge.style.display = 'none'; }
}

// ═══════════════════════════════════════
// MESSAGES
// ═══════════════════════════════════════
let messages = [];
let activeMessageId = null;

async function loadMessages() {
    try {
        const res = await fetch('/api/admin/contacts', { headers: { 'x-admin-token': token } });
        messages = (await res.json()).contacts || [];
        renderMessages();
        updateUnreadBadge('messages', messages);
        document.getElementById('messages-count').textContent = `${messages.length} total`;
    } catch { toast('Failed to load messages', 'error'); }
}

function renderMessages() {
    const list = document.getElementById('messages-list');
    if (!messages.length) { list.innerHTML = '<div class="list-empty">No messages yet.</div>'; return; }
    list.innerHTML = messages.map(m => `
        <div class="list-item ${m.id === activeMessageId ? 'active' : ''}" data-id="${m.id}" data-search="${(m.name + ' ' + m.subject + ' ' + m.email).toLowerCase()}">
            <div class="list-item-name" style="${!m.read ? 'color:var(--text)' : ''}">
                ${!m.read ? '<span style="display:inline-block;width:6px;height:6px;background:var(--primary);border-radius:50%;margin-right:6px;vertical-align:middle;flex-shrink:0;"></span>' : ''}${m.name}
            </div>
            <div class="list-item-tags">
                <span class="item-tag" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;">${m.subject}</span>
                <span class="tag-pill ${m.read ? 'pill-draft' : 'pill-live'}">${m.read ? 'Read' : 'New'}</span>
            </div>
        </div>
    `).join('');
    document.querySelectorAll('#messages-list .list-item').forEach(el =>
        el.addEventListener('click', () => openMessage(el.dataset.id))
    );
}

async function openMessage(id) {
    activeMessageId = id;
    const m = messages.find(m => m.id === id); if (!m) return;

    document.getElementById('message-empty').style.display = 'none';
    document.getElementById('message-detail').style.display = 'flex';

    document.getElementById('message-body-wrap').innerHTML = `
        <div style="display:flex;flex-direction:column;gap:1.75rem;">
            <div>
                <div class="field-label">Subject</div>
                <div style="font-family:'Space Grotesk',sans-serif;font-size:1.3rem;font-weight:800;letter-spacing:-0.01em;">${m.subject}</div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                <div>
                    <div class="field-label">From</div>
                    <div style="font-size:0.9rem;color:var(--text);font-weight:600;">${m.name}</div>
                </div>
                <div>
                    <div class="field-label">Email</div>
                    <a href="mailto:${m.email}" style="font-size:0.9rem;color:var(--primary);text-decoration:none;">${m.email}</a>
                </div>
            </div>
            <div>
                <div class="field-label">Received</div>
                <div style="font-size:0.85rem;color:var(--muted);">${fmtDate(m.createdAt)}</div>
            </div>
            <div>
                <div class="field-label">Message</div>
                <div style="background:var(--surface);border:1px solid var(--border);padding:1.25rem 1.5rem;color:var(--muted);font-size:0.9rem;line-height:1.8;white-space:pre-wrap;">${m.message}</div>
            </div>
            <a href="mailto:${m.email}?subject=Re: ${encodeURIComponent(m.subject)}" class="btn btn-primary" style="align-self:flex-start;">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="m3 3 1.664 9.136L12 12l7.336-.864L21 3 3 3z"/><path d="m12 12 0 9"/></svg>
                Reply via Email
            </a>
        </div>
    `;

    renderMessages();

    // Mark as read if not already
    if (!m.read) {
        try {
            await fetch(`/api/admin/contacts/${id}/read`, { method: 'PATCH', headers: { 'x-admin-token': token } });
            m.read = true;
            renderMessages();
            updateUnreadBadge('messages', messages);
        } catch (e) { /* silent */ }
    }
}

document.getElementById('delete-message-btn').addEventListener('click', () => {
    if (!activeMessageId) return;
    confirm('Delete Message?', 'This will permanently delete this message.', async () => {
        try {
            await fetch(`/api/admin/contacts/${activeMessageId}`, { method: 'DELETE', headers: { 'x-admin-token': token } });
            messages = messages.filter(m => m.id !== activeMessageId);
            activeMessageId = null;
            document.getElementById('message-empty').style.display = 'flex';
            document.getElementById('message-detail').style.display = 'none';
            renderMessages();
            updateUnreadBadge('messages', messages);
            document.getElementById('messages-count').textContent = `${messages.length} total`;
            toast('Message deleted');
        } catch { toast('Failed to delete', 'error'); }
    });
});

document.getElementById('messages-search').addEventListener('input', function () {
    const q = this.value.toLowerCase();
    document.querySelectorAll('#messages-list .list-item').forEach(el => {
        el.style.display = (el.dataset.search || '').includes(q) ? '' : 'none';
    });
});

// ═══════════════════════════════════════
// APPLICATIONS
// ═══════════════════════════════════════
let applications = [];
let activeApplicationId = null;

const STATUS_STYLES = {
    new:         { pill: 'pill-live',     label: 'New' },
    reviewing:   { pill: 'pill-featured', label: 'Reviewing' },
    shortlisted: { pill: 'pill-featured', label: 'Shortlisted' },
    rejected:    { pill: 'pill-draft',    label: 'Rejected' }
};

async function loadApplications() {
    try {
        const res = await fetch('/api/admin/applications', { headers: { 'x-admin-token': token } });
        applications = (await res.json()).applications || [];
        renderApplications();
        updateUnreadBadge('applications', applications);
        document.getElementById('applications-count').textContent = `${applications.length} total`;
    } catch { toast('Failed to load applications', 'error'); }
}

function renderApplications() {
    const list = document.getElementById('applications-list');
    if (!applications.length) { list.innerHTML = '<div class="list-empty">No applications yet.</div>'; return; }
    list.innerHTML = applications.map(a => {
        const s = STATUS_STYLES[a.status] || STATUS_STYLES.new;
        return `
        <div class="list-item ${a.id === activeApplicationId ? 'active' : ''}" data-id="${a.id}" data-search="${(a.name + ' ' + a.position + ' ' + a.email).toLowerCase()}">
            <div class="list-item-name" style="${!a.read ? 'color:var(--text)' : ''}">
                ${!a.read ? '<span style="display:inline-block;width:6px;height:6px;background:var(--primary);border-radius:50%;margin-right:6px;vertical-align:middle;flex-shrink:0;"></span>' : ''}${a.name}
            </div>
            <div class="list-item-tags">
                <span class="item-tag primary">${a.position}</span>
                <span class="tag-pill ${s.pill}">${s.label}</span>
            </div>
        </div>`;
    }).join('');
    document.querySelectorAll('#applications-list .list-item').forEach(el =>
        el.addEventListener('click', () => openApplication(el.dataset.id))
    );
}

async function openApplication(id) {
    activeApplicationId = id;
    const a = applications.find(a => a.id === id); if (!a) return;

    document.getElementById('application-empty').style.display = 'none';
    document.getElementById('application-detail').style.display = 'flex';
    document.getElementById('app-status-select').value = a.status || 'new';

    const answersHTML = a.answers?.length ? `
        <div class="form-section">
            <span class="form-section-label">Custom Questions</span>
            ${a.answers.map(ans => `
                <div>
                    <div class="field-label">${ans.question}</div>
                    <div style="background:var(--surface);border:1px solid var(--border);padding:1rem 1.25rem;color:var(--muted);font-size:0.875rem;line-height:1.8;white-space:pre-wrap;">${ans.answer || '—'}</div>
                </div>
            `).join('')}
        </div>` : '';

    document.getElementById('application-body-wrap').innerHTML = `
        <div style="display:flex;flex-direction:column;gap:1.75rem;">
            <div>
                <div class="field-label">Applying for</div>
                <div style="font-family:'Space Grotesk',sans-serif;font-size:1.3rem;font-weight:800;letter-spacing:-0.01em;">${a.position}</div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                <div>
                    <div class="field-label">Name</div>
                    <div style="font-size:0.9rem;color:var(--text);font-weight:600;">${a.name}</div>
                </div>
                <div>
                    <div class="field-label">Email</div>
                    <a href="mailto:${a.email}" style="font-size:0.9rem;color:var(--primary);text-decoration:none;">${a.email}</a>
                </div>
                ${a.discord ? `<div><div class="field-label">Discord</div><div style="font-size:0.875rem;color:var(--muted);">${a.discord}</div></div>` : ''}
                ${a.portfolio ? `<div><div class="field-label">Portfolio / GitHub</div><a href="${a.portfolio}" target="_blank" style="font-size:0.875rem;color:var(--primary);text-decoration:none;word-break:break-all;">${a.portfolio}</a></div>` : ''}
            </div>
            <div>
                <div class="field-label">Submitted</div>
                <div style="font-size:0.85rem;color:var(--muted);">${fmtDate(a.createdAt)}</div>
            </div>
            <div>
                <div class="field-label">Why they're a good fit</div>
                <div style="background:var(--surface);border:1px solid var(--border);padding:1.25rem 1.5rem;color:var(--muted);font-size:0.875rem;line-height:1.8;white-space:pre-wrap;">${a.experience}</div>
            </div>
            ${answersHTML}
            <a href="mailto:${a.email}?subject=Your application for ${encodeURIComponent(a.position)} at Switch" class="btn btn-primary" style="align-self:flex-start;">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="m3 3 1.664 9.136L12 12l7.336-.864L21 3 3 3z"/><path d="m12 12 0 9"/></svg>
                Reply via Email
            </a>
        </div>
    `;

    renderApplications();

    // Mark as read
    if (!a.read) {
        try {
            await fetch(`/api/admin/applications/${id}/status`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json', 'x-admin-token': token },
                body: JSON.stringify({ status: a.status || 'new' })
            });
            a.read = true;
            renderApplications();
            updateUnreadBadge('applications', applications);
        } catch (e) { /* silent */ }
    }
}

document.getElementById('save-app-status-btn').addEventListener('click', async () => {
    if (!activeApplicationId) return;
    const status = document.getElementById('app-status-select').value;
    try {
        await fetch(`/api/admin/applications/${activeApplicationId}/status`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json', 'x-admin-token': token },
            body: JSON.stringify({ status })
        });
        const a = applications.find(a => a.id === activeApplicationId);
        if (a) a.status = status;
        renderApplications();
        toast('Status updated ✓');
    } catch { toast('Failed to update status', 'error'); }
});

document.getElementById('delete-application-btn').addEventListener('click', () => {
    if (!activeApplicationId) return;
    confirm('Delete Application?', 'This will permanently delete this application.', async () => {
        try {
            await fetch(`/api/admin/applications/${activeApplicationId}`, { method: 'DELETE', headers: { 'x-admin-token': token } });
            applications = applications.filter(a => a.id !== activeApplicationId);
            activeApplicationId = null;
            document.getElementById('application-empty').style.display = 'flex';
            document.getElementById('application-detail').style.display = 'none';
            renderApplications();
            updateUnreadBadge('applications', applications);
            document.getElementById('applications-count').textContent = `${applications.length} total`;
            toast('Application deleted');
        } catch { toast('Failed to delete', 'error'); }
    });
});

document.getElementById('applications-search').addEventListener('input', function () {
    const q = this.value.toLowerCase();
    document.querySelectorAll('#applications-list .list-item').forEach(el => {
        el.style.display = (el.dataset.search || '').includes(q) ? '' : 'none';
    });
});

// ── SEARCH ─────────────────────────────────────────────────────────────────
document.getElementById('blog-search').addEventListener('input', function () {
    const q = this.value.toLowerCase();
    document.querySelectorAll('#posts-list .list-item').forEach(el => {
        el.style.display = (el.dataset.search || '').includes(q) ? '' : 'none';
    });
});

document.getElementById('career-search').addEventListener('input', function () {
    const q = this.value.toLowerCase();
    document.querySelectorAll('#careers-list .list-item').forEach(el => {
        el.style.display = (el.dataset.search || '').includes(q) ? '' : 'none';
    });
});

// ── KEYBOARD SHORTCUT ──────────────────────────────────────────────────────
document.addEventListener('keydown', e => {
    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        const tab = document.querySelector('.rail-link.active')?.dataset.tab;
        if (tab === 'games') document.getElementById('save-game-btn').click();
        if (tab === 'blog') document.getElementById('save-post-btn').click();
        if (tab === 'careers') document.getElementById('save-career-btn').click();
    }
});

// ═══════════════════════════════════════
// GAMES
// ═══════════════════════════════════════
async function loadGames() {
    try {
        const res = await fetch('/api/admin/games', { headers: { 'x-admin-token': token } });
        games = (await res.json()).games || [];
        renderGames();
    } catch { toast('Failed to load games', 'error'); }
}

function renderGames() {
    const list = document.getElementById('games-list');
    if (!games.length) { list.innerHTML = '<div class="list-empty">No games yet.<br>Hit <strong>+ New</strong> to add one.</div>'; return; }
    list.innerHTML = games.map(g => `
        <div class="list-item ${g.id === activeGameId ? 'active' : ''}" data-id="${g.id}">
            <div class="list-item-name">${g.placeId ? `Place ${g.placeId}` : 'New Game'}</div>
            <div class="list-item-tags">
                ${g.featured ? '<span class="item-tag primary">Featured</span>' : ''}
                <span class="tag-pill ${g.active ? 'pill-live' : 'pill-draft'}">${g.active ? 'Active' : 'Inactive'}</span>
            </div>
        </div>
    `).join('');
    document.querySelectorAll('#games-list .list-item').forEach(el =>
        el.addEventListener('click', () => openGame(el.dataset.id))
    );
}

function openGame(id) {
    activeGameId = id;
    const g = games.find(g => g.id === id); if (!g) return;
    document.getElementById('game-empty').style.display = 'none';
    document.getElementById('game-form').style.display = 'flex';
    document.getElementById('game-place-id').value = g.placeId || '';
    document.getElementById('game-active').checked = g.active !== false;
    document.getElementById('game-featured').checked = g.featured || false;
    document.getElementById('game-thumb-url').value = g.thumbnail || '';
    document.getElementById('game-thumb-preview').innerHTML = g.thumbnail
        ? `<img src="${g.thumbnail}">`
        : '<span class="thumb-preview-ph">No image uploaded</span>';
    renderGames();
}

document.getElementById('new-game-btn').addEventListener('click', async () => {
    try {
        const res = await fetch('/api/admin/games', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'x-admin-token': token },
            body: JSON.stringify({ placeId: '', active: false, featured: false, thumbnail: '' })
        });
        const d = await res.json();
        games.unshift(d.game);
        openGame(d.game.id);
        toast('Game created');
    } catch { toast('Failed to create game', 'error'); }
});

document.getElementById('save-game-btn').addEventListener('click', async () => {
    if (!activeGameId) return;
    const btn = document.getElementById('save-game-btn');
    btn.disabled = true; btn.textContent = 'Saving…';
    try {
        const res = await fetch(`/api/admin/games/${activeGameId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json', 'x-admin-token': token },
            body: JSON.stringify({
                placeId: document.getElementById('game-place-id').value,
                active: document.getElementById('game-active').checked,
                featured: document.getElementById('game-featured').checked,
                thumbnail: document.getElementById('game-thumb-url').value
            })
        });
        const d = await res.json();
        const idx = games.findIndex(g => g.id === activeGameId);
        if (idx !== -1) games[idx] = d.game;
        renderGames(); toast('Game saved ✓');
    } catch { toast('Failed to save', 'error'); }
    btn.disabled = false;
    btn.innerHTML = '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Save';
});

document.getElementById('delete-game-btn').addEventListener('click', () => {
    if (!activeGameId) return;
    confirm('Delete Game?', 'This will permanently remove this game. This cannot be undone.', async () => {
        try {
            await fetch(`/api/admin/games/${activeGameId}`, { method: 'DELETE', headers: { 'x-admin-token': token } });
            games = games.filter(g => g.id !== activeGameId);
            activeGameId = null;
            document.getElementById('game-empty').style.display = 'flex';
            document.getElementById('game-form').style.display = 'none';
            renderGames(); toast('Game deleted');
        } catch { toast('Failed to delete', 'error'); }
    });
});

// ═══════════════════════════════════════
// BLOG
// ═══════════════════════════════════════
async function loadPosts() {
    try {
        const res = await fetch('/api/admin/posts', { headers: { 'x-admin-token': token } });
        posts = (await res.json()).posts || [];
        renderPosts();
    } catch { toast('Failed to load posts', 'error'); }
}

function renderPosts() {
    const list = document.getElementById('posts-list');
    if (!posts.length) { list.innerHTML = '<div class="list-empty">No posts yet.</div>'; return; }
    list.innerHTML = posts.map(p => `
        <div class="list-item ${p.id === activePostId ? 'active' : ''}" data-id="${p.id}" data-search="${(p.title || '').toLowerCase()}">
            <div class="list-item-name">${p.title || 'Untitled'}</div>
            <div class="list-item-tags">
                <span class="item-tag">${fmtDate(p.updatedAt)}</span>
                <span class="tag-pill ${p.published ? 'pill-live' : 'pill-draft'}">${p.published ? 'Live' : 'Draft'}</span>
            </div>
        </div>
    `).join('');
    document.querySelectorAll('#posts-list .list-item').forEach(el =>
        el.addEventListener('click', () => openPost(el.dataset.id))
    );
}

function openPost(id) {
    activePostId = id;
    const p = posts.find(p => p.id === id); if (!p) return;
    document.getElementById('blog-empty').style.display = 'none';
    document.getElementById('blog-form').style.display = 'flex';
    document.getElementById('post-title').value = p.title || '';
    quill.root.innerHTML = p.content || '';
    document.getElementById('post-publish').checked = p.published || false;
    renderPosts();
}

document.getElementById('new-post-btn').addEventListener('click', async () => {
    try {
        const res = await fetch('/api/admin/posts', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'x-admin-token': token },
            body: JSON.stringify({ title: 'Untitled Post', content: '', published: false })
        });
        const d = await res.json();
        posts.unshift(d.post);
        openPost(d.post.id);
        toast('Post created');
    } catch { toast('Failed to create post', 'error'); }
});

document.getElementById('save-post-btn').addEventListener('click', async () => {
    if (!activePostId) return;
    const btn = document.getElementById('save-post-btn');
    btn.disabled = true; btn.textContent = 'Saving…';
    try {
        const res = await fetch(`/api/admin/posts/${activePostId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json', 'x-admin-token': token },
            body: JSON.stringify({
                title: document.getElementById('post-title').value,
                content: quill.root.innerHTML,
                published: document.getElementById('post-publish').checked
            })
        });
        const d = await res.json();
        const idx = posts.findIndex(p => p.id === activePostId);
        if (idx !== -1) posts[idx] = d.post;
        renderPosts(); toast('Post saved ✓');
    } catch { toast('Failed to save', 'error'); }
    btn.disabled = false;
    btn.innerHTML = '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Save';
});

document.getElementById('delete-post-btn').addEventListener('click', () => {
    if (!activePostId) return;
    confirm('Delete Post?', 'This will permanently delete this blog post. This cannot be undone.', async () => {
        try {
            await fetch(`/api/admin/posts/${activePostId}`, { method: 'DELETE', headers: { 'x-admin-token': token } });
            posts = posts.filter(p => p.id !== activePostId);
            activePostId = null;
            document.getElementById('blog-empty').style.display = 'flex';
            document.getElementById('blog-form').style.display = 'none';
            renderPosts(); toast('Post deleted');
        } catch { toast('Failed to delete', 'error'); }
    });
});

// ═══════════════════════════════════════
// CAREERS
// ═══════════════════════════════════════
async function loadCareers() {
    try {
        const res = await fetch('/api/admin/careers', { headers: { 'x-admin-token': token } });
        careers = (await res.json()).careers || [];
        renderCareers();
    } catch { toast('Failed to load careers', 'error'); }
}

function renderCareers() {
    const list = document.getElementById('careers-list');
    if (!careers.length) { list.innerHTML = '<div class="list-empty">No positions yet.</div>'; return; }
    list.innerHTML = careers.map(c => `
        <div class="list-item ${c.id === activeCareerId ? 'active' : ''}" data-id="${c.id}" data-search="${(c.title || '').toLowerCase()}">
            <div class="list-item-name">${c.title || 'Untitled Position'}</div>
            <div class="list-item-tags">
                ${c.department ? `<span class="item-tag primary">${c.department}</span>` : ''}
                <span class="item-tag">${c.type}</span>
                <span class="tag-pill ${c.active ? 'pill-live' : 'pill-draft'}">${c.active ? 'Active' : 'Inactive'}</span>
            </div>
        </div>
    `).join('');
    document.querySelectorAll('#careers-list .list-item').forEach(el =>
        el.addEventListener('click', () => openCareer(el.dataset.id))
    );
}

function dynItem(listId, val = '') {
    const list = document.getElementById(listId);
    const div = document.createElement('div');
    div.className = 'dyn-item';
    div.innerHTML = `<input class="field-input" type="text" value="${val.replace(/"/g, '&quot;')}" placeholder="Enter text…"><button class="dyn-remove" title="Remove">×</button>`;
    div.querySelector('.dyn-remove').addEventListener('click', () => div.remove());
    list.appendChild(div);
}

function dynValues(listId) {
    return Array.from(document.querySelectorAll(`#${listId} .dyn-item input`))
        .map(i => i.value.trim()).filter(Boolean);
}

document.getElementById('add-req').addEventListener('click', () => dynItem('req-list'));
document.getElementById('add-nice').addEventListener('click', () => dynItem('nice-list'));
document.getElementById('add-q').addEventListener('click', () => dynItem('q-list'));

function openCareer(id) {
    activeCareerId = id;
    const c = careers.find(c => c.id === id); if (!c) return;
    document.getElementById('career-empty').style.display = 'none';
    document.getElementById('career-form').style.display = 'flex';
    document.getElementById('career-title').value = c.title || '';
    document.getElementById('career-dept').value = c.department || '';
    document.getElementById('career-type').value = c.type || 'Full-time';
    document.getElementById('career-location').value = c.location || '';
    document.getElementById('career-desc').value = c.description || '';
    document.getElementById('career-active').checked = c.active !== false;
    document.getElementById('req-list').innerHTML = '';
    (c.requirements || []).forEach(r => dynItem('req-list', r));
    document.getElementById('nice-list').innerHTML = '';
    (c.niceToHave || []).forEach(r => dynItem('nice-list', r));
    document.getElementById('q-list').innerHTML = '';
    (c.questions || []).forEach(q => dynItem('q-list', typeof q === 'string' ? q : q.label));
    renderCareers();
}

document.getElementById('new-career-btn').addEventListener('click', async () => {
    try {
        const res = await fetch('/api/admin/careers', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'x-admin-token': token },
            body: JSON.stringify({ title: 'New Position', type: 'Full-time', location: 'Remote', active: false })
        });
        const d = await res.json();
        careers.unshift(d.career);
        openCareer(d.career.id);
        toast('Position created');
    } catch { toast('Failed to create position', 'error'); }
});

document.getElementById('save-career-btn').addEventListener('click', async () => {
    if (!activeCareerId) return;
    const btn = document.getElementById('save-career-btn');
    btn.disabled = true; btn.textContent = 'Saving…';
    const questions = dynValues('q-list').map(q => ({ label: q, required: true }));
    try {
        const res = await fetch(`/api/admin/careers/${activeCareerId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json', 'x-admin-token': token },
            body: JSON.stringify({
                title: document.getElementById('career-title').value,
                department: document.getElementById('career-dept').value,
                type: document.getElementById('career-type').value,
                location: document.getElementById('career-location').value,
                description: document.getElementById('career-desc').value,
                requirements: dynValues('req-list'),
                niceToHave: dynValues('nice-list'),
                questions,
                active: document.getElementById('career-active').checked
            })
        });
        const d = await res.json();
        const idx = careers.findIndex(c => c.id === activeCareerId);
        if (idx !== -1) careers[idx] = d.career;
        renderCareers(); toast('Position saved ✓');
    } catch { toast('Failed to save', 'error'); }
    btn.disabled = false;
    btn.innerHTML = '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Save';
});

document.getElementById('delete-career-btn').addEventListener('click', () => {
    if (!activeCareerId) return;
    confirm('Delete Position?', 'This will permanently remove this job posting. This cannot be undone.', async () => {
        try {
            await fetch(`/api/admin/careers/${activeCareerId}`, { method: 'DELETE', headers: { 'x-admin-token': token } });
            careers = careers.filter(c => c.id !== activeCareerId);
            activeCareerId = null;
            document.getElementById('career-empty').style.display = 'flex';
            document.getElementById('career-form').style.display = 'none';
            renderCareers(); toast('Position deleted');
        } catch { toast('Failed to delete', 'error'); }
    });
});
</script>
</body>
</html>