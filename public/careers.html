<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Careers — Switch</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FBBF24;
            --bg: #0A0A0A;
            --surface: #111111;
            --surface-mid: #181818;
            --border: #242424;
            --text: #F5F5F5;
            --muted: #808080;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
        h1, h2, h3, h4 { font-family: 'Space Grotesk', sans-serif; }

        /* ── PAGE HEADER ── */
        .page-header {
            padding: 120px 2rem 3.5rem;
            border-bottom: 1px solid var(--border);
        }
        .page-header-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: flex-end;
            gap: 2rem;
        }
        .section-label { font-size: 0.68rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.2em; color: var(--primary); display: block; margin-bottom: 0.75rem; }
        .page-header h1 { font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; letter-spacing: -0.02em; }
        .page-header p { margin-top: 0.625rem; color: var(--muted); font-size: 0.95rem; max-width: 500px; }

        /* ── SEARCH BAR ── */
        .search-wrap { position: relative; }
        .search-icon { position: absolute; left: 0.875rem; top: 50%; transform: translateY(-50%); color: var(--muted); pointer-events: none; }
        .search-input {
            width: 280px;
            padding: 0.65rem 1rem 0.65rem 2.5rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            outline: none;
            transition: border-color 0.15s;
        }
        .search-input::placeholder { color: #3a3a3a; }
        .search-input:focus { border-color: var(--primary); }

        /* ── MAIN LAYOUT: sidebar + detail ── */
        .careers-layout {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem 6rem;
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 0;
            min-height: 600px;
        }

        /* ── LEFT: JOB LIST ── */
        .jobs-sidebar {
            border-right: 1px solid var(--border);
            overflow-y: auto;
        }

        .filter-bar {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .filter-select {
            padding: 0.45rem 2rem 0.45rem 0.75rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%23808080' stroke-width='2.5'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.625rem center;
            outline: none;
            transition: border-color 0.15s;
        }
        .filter-select:focus { border-color: var(--primary); }

        .results-count { font-size: 0.75rem; color: var(--muted); white-space: nowrap; }
        .results-count strong { color: var(--text); }

        .job-list { display: flex; flex-direction: column; }

        .job-item {
            padding: 1.375rem 1.5rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.12s;
            border-left: 3px solid transparent;
        }
        .job-item:hover { background: var(--surface-mid); }
        .job-item.active { background: var(--surface-mid); border-left-color: var(--primary); }

        .job-item-title { font-family: 'Space Grotesk', sans-serif; font-size: 0.95rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--text); }
        .job-item.active .job-item-title { color: var(--primary); }

        .job-item-tags { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .job-tag {
            font-size: 0.68rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
        }
        .job-tag.dept { color: var(--primary); }
        .job-tag::before { content: '·'; margin-right: 0.3rem; color: var(--border); }
        .job-tag:first-child::before { display: none; }

        .job-list-empty { padding: 3rem 1.5rem; text-align: center; color: var(--muted); font-size: 0.875rem; }

        /* ── RIGHT: JOB DETAIL ── */
        .job-detail {
            padding: 3rem 3.5rem;
            overflow-y: auto;
        }

        .detail-placeholder {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: var(--muted);
            padding: 4rem 2rem;
        }
        .detail-placeholder svg { opacity: 0.15; margin-bottom: 1.5rem; }
        .detail-placeholder p { font-size: 0.875rem; }

        .detail-eyebrow {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .detail-tag {
            display: inline-flex;
            align-items: center;
            padding: 0.3rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 3px;
            font-size: 0.72rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--muted);
        }
        .detail-tag.dept { border-color: rgba(251,191,36,0.3); color: var(--primary); }

        .detail-title { font-size: clamp(1.5rem, 2.5vw, 2.25rem); font-weight: 800; margin-bottom: 2.5rem; line-height: 1.1; }

        .detail-section { margin-bottom: 2rem; }
        .detail-section-label { font-size: 0.68rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.18em; color: var(--muted); margin-bottom: 0.875rem; }
        .detail-desc { color: var(--muted); font-size: 0.95rem; line-height: 1.8; }

        .detail-list { list-style: none; display: flex; flex-direction: column; gap: 0.625rem; }
        .detail-list li { color: var(--muted); font-size: 0.9rem; padding-left: 1.25rem; position: relative; line-height: 1.6; }
        .detail-list li::before { content: '—'; position: absolute; left: 0; color: var(--primary); font-weight: 700; }

        .detail-divider { border: none; border-top: 1px solid var(--border); margin: 2.5rem 0; }

        .apply-area { margin-top: 2.5rem; padding-top: 2.5rem; border-top: 1px solid var(--border); }
        .apply-area h4 { font-size: 1.1rem; margin-bottom: 0.5rem; }
        .apply-area p { color: var(--muted); font-size: 0.875rem; margin-bottom: 1.5rem; }
        .apply-actions { display: flex; gap: 0.75rem; flex-wrap: wrap; align-items: center; }
        .copy-role-btn { display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.75rem 1.25rem; background: transparent; border: 1px solid var(--border); border-radius: 4px; color: var(--muted); font-family: 'Inter', sans-serif; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: background 0.15s, color 0.15s, border-color 0.15s; white-space: nowrap; }
        .copy-role-btn:hover { color: var(--text); border-color: #3a3a3a; }
        .copy-role-btn.copied { background: rgba(251,191,36,0.08); color: var(--primary); border-color: rgba(251,191,36,0.35); }
        /* Toast */
        #sw-toast { position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%) translateY(12px); background: var(--surface); border: 1px solid var(--border); color: var(--text); font-family: 'Inter', sans-serif; font-size: 0.8rem; font-weight: 500; padding: 0.6rem 1.25rem; border-radius: 4px; opacity: 0; pointer-events: none; transition: opacity 0.2s, transform 0.2s; z-index: 99999; white-space: nowrap; }
        #sw-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* ── BUTTONS ── */
        .btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.75rem; border-radius: 4px; font-family: 'Inter', sans-serif; font-weight: 600; font-size: 0.875rem; text-decoration: none; cursor: pointer; border: none; letter-spacing: 0.02em; transition: background 0.15s, color 0.15s, border-color 0.15s; }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-primary:hover { background: #E5A800; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }

        /* ── APPLICATION MODAL ── */
        .modal { display: none; position: fixed; inset: 0; z-index: 2000; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; padding: 1.5rem; }
        .modal.open { display: flex; }
        .modal-backdrop { position: absolute; inset: 0; }
        .modal-box { position: relative; z-index: 1; background: var(--surface); border: 1px solid var(--border); width: 100%; max-width: 560px; max-height: 90vh; overflow-y: auto; padding: 2.5rem; }
        .modal-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem; margin-bottom: 2rem; }
        .modal-title { font-size: 1.3rem; font-weight: 700; }
        .modal-close { background: var(--surface-mid); border: 1px solid var(--border); color: var(--muted); width: 32px; height: 32px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1rem; border-radius: 2px; transition: background 0.15s, color 0.15s; }
        .modal-close:hover { background: var(--primary); color: #000; border-color: var(--primary); }
        .modal-form { display: flex; flex-direction: column; gap: 1.125rem; }
        .form-group { display: flex; flex-direction: column; gap: 0.375rem; }
        .form-group label { font-size: 0.72rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); }
        .form-group input, .form-group textarea { padding: 0.75rem 1rem; background: var(--bg); border: 1px solid var(--border); border-radius: 4px; color: var(--text); font-family: 'Inter', sans-serif; font-size: 0.9rem; outline: none; transition: border-color 0.15s; }
        .form-group input:focus, .form-group textarea:focus { border-color: var(--primary); }
        .form-group input::placeholder, .form-group textarea::placeholder { color: #3a3a3a; }
        .form-status { padding: 0.75rem 1rem; border-radius: 4px; font-size: 0.875rem; display: none; }
        .form-status.success { background: rgba(251,191,36,0.08); border: 1px solid rgba(251,191,36,0.2); color: var(--primary); }
        .form-status.error { background: rgba(239,68,68,0.08); border: 1px solid rgba(239,68,68,0.2); color: #f87171; }

        /* ── RESPONSIVE ── */
        @media (max-width: 900px) {
            .careers-layout { grid-template-columns: 1fr; }
            .jobs-sidebar { border-right: none; border-bottom: 1px solid var(--border); max-height: 420px; overflow-y: auto; }
            .job-detail { padding: 2.5rem 1.5rem; }
            .page-header-inner { grid-template-columns: 1fr; }
            .search-wrap { width: 100%; }
            .search-input { width: 100%; }
        }
        @media (max-width: 600px) {
            .page-header { padding: 100px 1.25rem 2.5rem; }
            .careers-layout { padding: 0 1.25rem 4rem; }
            .job-detail { padding: 2rem 1.25rem; }
        }
    </style>
</head>
<body>

<div class="page-header">
    <div class="page-header-inner">
        <div>
            <span class="section-label">ARE YOU LOOKING TO...</span>
            <h1>Work with Us</h1>
            <p>Help build the next generation of Roblox experiences. We're a small team that moves fast and builds things people love.</p>
        </div>
        <div class="search-wrap">
            <svg class="search-icon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            <input type="text" class="search-input" id="search-input" placeholder="Search roles…">
        </div>
    </div>
</div>

<div class="careers-layout">
    <!-- LEFT: Job List -->
    <div class="jobs-sidebar">
        <div class="filter-bar">
            <select class="filter-select" id="filter-dept"><option value="">All Depts</option></select>
            <select class="filter-select" id="filter-type">
                <option value="">All Types</option>
                <option>Full-time</option>
                <option>Part-time</option>
                <option>Contract</option>
                <option>Volunteer</option>
            </select>
            <span class="results-count" id="results-count">—</span>
        </div>
        <div class="job-list" id="job-list">
            <div class="job-list-empty">Loading positions…</div>
        </div>
    </div>

    <!-- RIGHT: Job Detail -->
    <div class="job-detail" id="job-detail">
        <div class="detail-placeholder">
            <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>
            <p>Select a role on the left to view details</p>
        </div>
    </div>
</div>

<div id="sw-toast"></div>

<script src="navbar.js"></script>
<script src="footer.js"></script>
<script>
    let allCareers = [];
    let selectedCareer = null;

    let toastTimer;
    function showToast(msg) {
        const t = document.getElementById('sw-toast');
        t.textContent = msg;
        t.classList.add('show');
        clearTimeout(toastTimer);
        toastTimer = setTimeout(() => t.classList.remove('show'), 2200);
    }

    // ── FILTERS ──
    const searchInput = document.getElementById('search-input');
    const filterDept = document.getElementById('filter-dept');
    const filterType = document.getElementById('filter-type');

    function applyFilters() {
        const q = searchInput.value.toLowerCase().trim();
        const dept = filterDept.value;
        const type = filterType.value;
        const filtered = allCareers.filter(c => {
            const mq = !q || c.title.toLowerCase().includes(q) || (c.description||'').toLowerCase().includes(q) || (c.department||'').toLowerCase().includes(q);
            const md = !dept || c.department === dept;
            const mt = !type || c.type === type;
            return mq && md && mt;
        });
        renderList(filtered);
    }
    searchInput.addEventListener('input', applyFilters);
    filterDept.addEventListener('change', applyFilters);
    filterType.addEventListener('change', applyFilters);

    // ── RENDER LIST ──
    function renderList(careers) {
        const list = document.getElementById('job-list');
        const count = document.getElementById('results-count');
        count.innerHTML = `<strong>${careers.length}</strong> role${careers.length!==1?'s':''}`;

        if (!careers.length) {
            list.innerHTML = '<div class="job-list-empty">No roles match your search.</div>';
            return;
        }

        list.innerHTML = careers.map(c => `
            <div class="job-item ${selectedCareer?.id===c.id?'active':''}" onclick="selectCareer('${c.id}')">
                <div class="job-item-title">${c.title}</div>
                <div class="job-item-tags">
                    ${c.department?`<span class="job-tag dept">${c.department}</span>`:''}
                    <span class="job-tag">${c.type}</span>
                    <span class="job-tag">${c.location}</span>
                </div>
            </div>
        `).join('');

        // Re-select if previously selected career still visible
        if (selectedCareer && careers.find(c=>c.id===selectedCareer.id)) {
            document.querySelector(`.job-item[onclick="selectCareer('${selectedCareer.id}')"]`)?.classList.add('active');
        }
    }

    // ── RENDER DETAIL ──
    function selectCareer(id) {
        const career = allCareers.find(c=>c.id===id);
        if (!career) return;
        selectedCareer = career;

        // Update active state in list
        document.querySelectorAll('.job-item').forEach(el => el.classList.remove('active'));
        document.querySelector(`.job-item[onclick="selectCareer('${id}')"]`)?.classList.add('active');

        const detail = document.getElementById('job-detail');
        detail.innerHTML = `
            <div class="detail-eyebrow">
                ${career.department?`<span class="detail-tag dept">${career.department}</span>`:''}
                <span class="detail-tag">${career.type}</span>
                <span class="detail-tag">${career.location}</span>
            </div>
            <h2 class="detail-title">${career.title}</h2>

            ${career.description?`
            <div class="detail-section">
                <div class="detail-section-label">About the Role</div>
                <p class="detail-desc">${career.description}</p>
            </div>`:''}

            ${career.requirements?.length?`
            <div class="detail-section">
                <div class="detail-section-label">Requirements</div>
                <ul class="detail-list">${career.requirements.map(r=>`<li>${r}</li>`).join('')}</ul>
            </div>`:''}

            ${career.niceToHave?.length?`
            <div class="detail-section">
                <div class="detail-section-label">Nice to Have</div>
                <ul class="detail-list">${career.niceToHave.map(r=>`<li>${r}</li>`).join('')}</ul>
            </div>`:''}

            ${career.salary ? `<div class="detail-section"><div class="detail-section-label">Compensation</div><div style="color:var(--primary);font-weight:600;font-size:1rem;">${career.salary}</div></div>` : ''}

            <div class="apply-area">
                <h4>Ready to apply?</h4>
                <p>Send us your details and we'll get back to you within a few days.</p>
                <div class="apply-actions">
                    <button class="btn btn-primary" onclick="openApply()">
                        Apply for this Role
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </button>
                    <button class="copy-role-btn" id="copy-role-btn" onclick="copyRoleLink()">
                        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                        Copy Link
                    </button>
                </div>
            </div>
        `;

        // Scroll detail to top
        detail.scrollTop = 0;

        // Update URL so the role is deep-linkable
        history.replaceState(null, '', `/careers?role=${id}`);
    }

    // ── COPY ROLE LINK ───────────────────────────────────────────────────
    function copyRoleLink() {
        if (!selectedCareer) return;
        const url = `${location.origin}/careers?role=${selectedCareer.id}`;
        const btn = document.getElementById('copy-role-btn');
        const doFeedback = () => {
            if (btn) {
                btn.classList.add('copied');
                btn.innerHTML = `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg> Copied!`;
                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.innerHTML = `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> Copy Link`;
                }, 2200);
            }
            showToast('Link copied to clipboard');
        };
        const fallback = () => {
            try {
                const ta = document.createElement('textarea');
                ta.value = url; ta.style.cssText = 'position:fixed;opacity:0;top:0;left:0;';
                document.body.appendChild(ta); ta.focus(); ta.select();
                document.execCommand('copy'); document.body.removeChild(ta);
                doFeedback();
            } catch { showToast('Copy: ' + url); }
        };
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(url).then(doFeedback).catch(fallback);
        } else { fallback(); }
    }

    function openApply() {
        if (!selectedCareer) return;
        window.location.href = `/apply?role=${selectedCareer.id}`;
    }

    function closeModal() {}

    // ── LOAD ──
    async function loadCareers() {
        try {
            const {careers} = await fetch('/api/careers').then(r=>r.json());
            allCareers = careers||[];

            // Populate dept filter
            [...new Set(allCareers.map(c=>c.department).filter(Boolean))].forEach(d=>{
                const opt=document.createElement('option'); opt.value=d; opt.textContent=d;
                document.getElementById('filter-dept').appendChild(opt);
            });

            if (!allCareers.length) {
                document.getElementById('job-list').innerHTML='<div class="job-list-empty">No open positions right now — check back soon.</div>';
                document.getElementById('results-count').innerHTML='<strong>0</strong> roles';
                return;
            }

            applyFilters();

            // Auto-select from URL ?role=ID if present, otherwise first
            const roleId = new URLSearchParams(location.search).get('role');
            const toSelect = roleId && allCareers.find(c=>c.id===roleId) ? roleId : allCareers[0]?.id;
            if (toSelect) selectCareer(toSelect);
        } catch(e) {
            document.getElementById('job-list').innerHTML='<div class="job-list-empty">Failed to load positions.</div>';
        }
    }

    loadCareers();
</script>
</body>
</html>