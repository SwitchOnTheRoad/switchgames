<!DOCTYPE html>
<html lang="en">
<head>
    <script src="/loader.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Switch</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FBBF24;
            --bg: #0A0A0A;
            --surface: #111111;
            --surface-mid: #181818;
            --border: #242424;
            --text: #F5F5F5;
            --muted: #808080;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; overflow-x: hidden; }
        h1, h2, h3, h4 { font-family: 'Space Grotesk', sans-serif; font-weight: 700; line-height: 1.1; }

        /* ── HERO ── */
        .hero {
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 80px 2rem 6rem;
            overflow: hidden;
        }
        .hero-bg {
            position: absolute;
            inset: 0;
        }
        .hero-bg img {
            width: 100%; height: 100%;
            object-fit: cover;
            opacity: 0.3;
        }
        .hero-bg::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(10,10,10,0.2) 0%, rgba(10,10,10,0.55) 60%, rgba(10,10,10,1) 100%);
        }
        .hero-content { position: relative; z-index: 1; display: flex; flex-direction: column; align-items: center; }
        .hero-logo { max-width: min(88vw, 700px); height: auto; margin-bottom: 1.75rem; }
        .hero-sub { font-size: clamp(0.95rem, 1.6vw, 1.15rem); color: var(--muted); max-width: 480px; margin-bottom: 2.5rem; }
        .hero-btns { display: flex; gap: 0.875rem; flex-wrap: wrap; justify-content: center; }
        .scroll-hint {
            position: absolute; bottom: 2.5rem; left: 50%; transform: translateX(-50%);
            z-index: 1; display: flex; flex-direction: column; align-items: center;
            gap: 0.5rem; color: var(--muted); font-size: 0.68rem; letter-spacing: 0.14em; text-transform: uppercase;
        }
        .scroll-line { width: 1px; height: 36px; background: linear-gradient(to bottom, var(--muted), transparent); animation: sl 2s ease-in-out infinite; }
        @keyframes sl { 0%,100%{opacity:1} 50%{opacity:0.3} }

        /* ── BUTTONS ── */
        .btn {
            display: inline-flex; align-items: center; gap: 0.5rem;
            padding: 0.75rem 1.75rem; border-radius: 4px;
            font-family: 'Inter', sans-serif; font-weight: 600; font-size: 0.875rem;
            text-decoration: none; cursor: pointer; border: none; letter-spacing: 0.02em;
            transition: background 0.15s, color 0.15s, border-color 0.15s;
        }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-primary:hover { background: #E5A800; }
        .btn-outline { background: transparent; border: 1px solid rgba(255,255,255,0.2); color: var(--text); }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }

        /* ── STATS ── */
        .stats-bar { border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); background: var(--surface); }
        .stats-inner { max-width: 1200px; margin: 0 auto; padding: 3rem 2rem; display: grid; grid-template-columns: repeat(4,1fr); gap: 2rem; }
        .stat { text-align: center; }
        .stat-value { font-family: 'Space Grotesk', sans-serif; font-size: clamp(2rem,4vw,3rem); font-weight: 800; color: var(--primary); display: block; margin-bottom: 0.25rem; letter-spacing: -0.02em; }
        .stat-label { font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.14em; color: var(--muted); }

        /* ── SECTION UTILS ── */
        .section-label { font-size: 0.68rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.2em; color: var(--primary); display: block; margin-bottom: 0.75rem; }
        .section-heading { font-size: clamp(1.75rem, 3vw, 2.5rem); font-weight: 800; letter-spacing: -0.02em; }

        /* ── FEATURED GAME ── */
        .featured-section { max-width: 1200px; margin: 0 auto; padding: 5rem 2rem; }
        .featured-card {
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            border: 1px solid var(--border);
            background: var(--surface);
            overflow: hidden;
        }
        .featured-img-wrap {
            position: relative;
            overflow: hidden;
            /* Fill the whole left column */
            min-height: 360px;
        }
        .featured-img-wrap img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.4s ease;
        }
        .featured-img-wrap:hover img { transform: scale(1.04); }
        .featured-info { padding: 3rem; display: flex; flex-direction: column; justify-content: space-between; border-left: 1px solid var(--border); }
        .featured-name { font-size: 1.75rem; font-weight: 800; margin-bottom: 1rem; }
        .featured-desc { color: var(--muted); font-size: 0.95rem; line-height: 1.7; margin-bottom: 2rem; }
        .featured-nums { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; padding: 1.5rem 0; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); margin-bottom: 2rem; }
        .featured-num-label { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.14em; color: var(--muted); margin-bottom: 0.375rem; }
        .featured-num-val { font-family: 'Space Grotesk', sans-serif; font-size: 1.75rem; font-weight: 800; color: var(--primary); }

        /* ── VISION / ABOUT ── */
        .about-section { border-top: 1px solid var(--border); }
        .about-inner { max-width: 1200px; margin: 0 auto; padding: 5rem 2rem; display: grid; grid-template-columns: 1fr 1fr; gap: 5rem; align-items: center; }
        .about-text {}
        .about-text .section-heading { margin-bottom: 1.5rem; }
        .about-text p { color: var(--muted); font-size: 0.975rem; line-height: 1.8; margin-bottom: 1.25rem; }
        .about-text p:last-child { margin-bottom: 0; }
        .about-pillars { display: flex; flex-direction: column; gap: 1px; background: var(--border); border: 1px solid var(--border); }
        .about-pillar { background: var(--surface); padding: 1.75rem 2rem; }
        .about-pillar-num { font-family: 'Space Grotesk', sans-serif; font-size: 0.68rem; font-weight: 700; color: var(--primary); letter-spacing: 0.18em; margin-bottom: 0.5rem; }
        .about-pillar h4 { font-size: 1rem; font-weight: 700; margin-bottom: 0.5rem; }
        .about-pillar p { color: var(--muted); font-size: 0.875rem; line-height: 1.65; }

        /* ── BLOG ── */
        .blog-section { border-top: 1px solid var(--border); padding: 5rem 2rem; }
        .blog-inner { max-width: 1200px; margin: 0 auto; }
        .section-hdr { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 2.5rem; }
        .blog-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 1px; background: var(--border); border: 1px solid var(--border); }
        .blog-card { background: var(--surface); cursor: pointer; transition: background 0.15s; display: flex; flex-direction: column; }
        .blog-card:hover { background: var(--surface-mid); }
        .blog-thumb { width: 100%; aspect-ratio: 16/9; object-fit: cover; display: block; }
        .blog-thumb-ph { width: 100%; aspect-ratio: 16/9; background: var(--surface-mid); border-bottom: 1px solid var(--border); }
        .blog-body { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; }
        .blog-meta-row { display: flex; justify-content: space-between; margin-bottom: 0.75rem; }
        .blog-date { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.12em; color: var(--primary); }
        .blog-rt { font-size: 0.68rem; color: var(--muted); }
        .blog-title { font-size: 1rem; font-weight: 700; line-height: 1.35; margin-bottom: 0.625rem; }
        .blog-preview { color: var(--muted); font-size: 0.85rem; line-height: 1.65; }

        /* ── CAREERS TEASER ── */
        .careers-section { border-top: 1px solid var(--border); }
        .careers-inner { max-width: 1200px; margin: 0 auto; padding: 5rem 2rem; }
        .careers-hdr { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 2.5rem; }
        .open-roles-list { display: flex; flex-direction: column; border: 1px solid var(--border); }
        .open-role-row {
            display: grid; grid-template-columns: 1fr auto;
            align-items: center; gap: 1rem;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
            text-decoration: none; color: inherit;
            transition: background 0.15s;
            cursor: pointer;
        }
        .open-role-row:last-child { border-bottom: none; }
        .open-role-row:hover { background: var(--surface-mid); }
        .open-role-title { font-weight: 700; font-size: 1rem; margin-bottom: 0.3rem; }
        .open-role-meta { display: flex; gap: 1rem; }
        .open-role-tag { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); }
        .open-role-tag.dept { color: var(--primary); }
        .role-arrow { color: var(--muted); font-size: 1.2rem; transition: transform 0.15s, color 0.15s; }
        .open-role-row:hover .role-arrow { transform: translateX(4px); color: var(--primary); }
        .no-roles { padding: 3rem 2rem; text-align: center; color: var(--muted); font-size: 0.875rem; background: var(--surface); border: 1px solid var(--border); }

        /* ── CONTACT ── */
        .contact-section { border-top: 1px solid var(--border); padding: 5rem 2rem; }
        .contact-inner { max-width: 700px; margin: 0 auto; }
        .contact-form { margin-top: 3rem; display: flex; flex-direction: column; gap: 1.25rem; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; }
        .form-group { display: flex; flex-direction: column; gap: 0.375rem; }
        .form-group label { font-size: 0.72rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); }
        .form-group input, .form-group textarea {
            padding: 0.75rem 1rem; background: var(--surface); border: 1px solid var(--border);
            border-radius: 4px; color: var(--text); font-family: 'Inter', sans-serif; font-size: 0.9rem;
            outline: none; transition: border-color 0.15s;
        }
        .form-group input:focus, .form-group textarea:focus { border-color: var(--primary); }
        .form-group input::placeholder, .form-group textarea::placeholder { color: #3a3a3a; }
        .form-status { padding: 0.75rem 1rem; border-radius: 4px; font-size: 0.875rem; display: none; }
        .form-status.success { background: rgba(251,191,36,0.08); border: 1px solid rgba(251,191,36,0.2); color: var(--primary); }
        .form-status.error { background: rgba(239,68,68,0.08); border: 1px solid rgba(239,68,68,0.2); color: #f87171; }

        /* ── BLOG MODAL ── */
        .modal { display: none; position: fixed; inset: 0; z-index: 9999; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; padding: 2rem; }
        .modal.open { display: flex; }
        .modal-content { background: var(--surface); border: 1px solid var(--border); max-width: 760px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-header { padding: 2rem 2rem 1.5rem; border-bottom: 1px solid var(--border); }
        .modal-meta { display: flex; gap: 1.25rem; font-size: 0.7rem; letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 0.75rem; }
        .modal-meta span:first-child { color: var(--primary); }
        .modal-meta span:last-child { color: var(--muted); }
        .modal-title { font-size: 1.75rem; }
        .modal-close { position: absolute; top: 1.25rem; right: 1.25rem; background: var(--surface-mid); border: 1px solid var(--border); color: var(--muted); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1rem; border-radius: 2px; transition: background 0.15s, color 0.15s; }
        .modal-close:hover { background: var(--primary); color: #000; border-color: var(--primary); }
        .modal-body { padding: 2rem; line-height: 1.8; color: var(--muted); font-size: 1rem; }
        .modal-body img { max-width: 100%; margin: 1rem 0; }
        .modal-body h2, .modal-body h3 { color: var(--text); margin: 1.5rem 0 0.75rem; }

        /* ── RESPONSIVE ── */
        @media (max-width: 1000px) {
            .about-inner { grid-template-columns: 1fr; gap: 3rem; }
            .featured-card { grid-template-columns: 1fr; }
            .featured-img-wrap { min-height: 280px; }
            .featured-info { border-left: none; border-top: 1px solid var(--border); padding: 2rem; }
            .stats-inner { grid-template-columns: repeat(2,1fr); }
            .blog-grid { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 640px) {
            .hero { padding: 80px 1.25rem 4rem; }
            .hero-btns { flex-direction: column; width: 100%; max-width: 260px; }
            .btn { justify-content: center; }
            .featured-section, .blog-section, .contact-section, .careers-inner { padding: 3.5rem 1.25rem; }
            .about-inner { padding: 3.5rem 1.25rem; }
            .stats-inner { padding: 2.5rem 1.25rem; }
            .form-row { grid-template-columns: 1fr; }
            .blog-grid { grid-template-columns: 1fr; }
            .section-hdr, .careers-hdr { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .open-role-row { padding: 1.25rem; }
        }
    </style>
</head>
<body>

<!-- HERO -->
<section class="hero">
    <div class="hero-bg"><img src="hero.png" alt=""></div>
    <div class="hero-content">
        <img src="heroextended.png" alt="Switch" class="hero-logo">
        <p class="hero-sub">An independent Roblox studio building immersive experiences for millions of players.</p>
        <div class="hero-btns">
            <a href="/games" class="btn btn-primary">Explore Games <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></a>
            <a href="#contact" class="btn btn-outline">Contact Us</a>
        </div>
    </div>
    <div class="scroll-hint"><span>Scroll</span><div class="scroll-line"></div></div>
</section>

<!-- STATS -->
<div class="stats-bar">
    <div class="stats-inner">
        <div class="stat"><span class="stat-value" id="games-count">—</span><span class="stat-label">Games</span></div>
        <div class="stat"><span class="stat-value" id="ccu-display">—</span><span class="stat-label">Playing Now</span></div>
        <div class="stat"><span class="stat-value" id="visit-display">—</span><span class="stat-label">Total Visits</span></div>
        <div class="stat"><span class="stat-value">2025</span><span class="stat-label">Founded</span></div>
    </div>
</div>

<!-- FEATURED GAME -->
<div id="featured-wrap" style="display:none; border-top: 1px solid var(--border);">
    <section class="featured-section">
        <span class="section-label">Now Playing</span>
        <h2 class="section-heading" style="margin-bottom:2.5rem;">Featured Game</h2>
        <div class="featured-card">
            <a href="#" class="featured-img-wrap" id="featured-link">
                <img src="" alt="" id="featured-img">
            </a>
            <div class="featured-info">
                <div>
                    <h3 class="featured-name" id="featured-name">—</h3>
                    <p class="featured-desc" id="featured-desc">An immersive Roblox experience crafted by the Switch team.</p>
                </div>
                <div>
                    <div class="featured-nums">
                        <div><div class="featured-num-label">Playing Now</div><div class="featured-num-val" id="featured-playing">—</div></div>
                        <div><div class="featured-num-label">Total Visits</div><div class="featured-num-val" id="featured-visits">—</div></div>
                    </div>
                    <a href="#" class="btn btn-primary" id="featured-play-btn" style="width:100%;justify-content:center;">
                        Play on Roblox <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </a>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- VISION / ABOUT -->
<div class="about-section">
    <div class="about-inner">
        <div class="about-text">
            <span class="section-label">Our Vision</span>
            <h2 class="section-heading">Building worlds that bring people together</h2>
            <p>Switch is an independent Roblox game studio founded in 2025. We create games that are polished, competitive, and community-driven — experiences that players come back to again and again.</p>
            <p>We believe Roblox is one of the most exciting platforms for reaching millions of players. Our team works fast, ships often, and listens closely to our communities to build what players actually want to play.</p>
            <a href="/games" class="btn btn-outline" style="margin-top:1rem;">See Our Games</a>
        </div>
        <div class="about-pillars">
            <div class="about-pillar">
                <div class="about-pillar-num">01</div>
                <h4>Community First</h4>
                <p>We build for players. Every design decision starts with what makes the game more fun and rewarding for our community.</p>
            </div>
            <div class="about-pillar">
                <div class="about-pillar-num">02</div>
                <h4>Quality Over Quantity</h4>
                <p>We'd rather ship one great game than ten mediocre ones. Polish and attention to detail are non-negotiable.</p>
            </div>
            <div class="about-pillar">
                <div class="about-pillar-num">03</div>
                <h4>Rapid Iteration</h4>
                <p>Fast feedback loops, weekly updates, and constant improvement. We don't sit still.</p>
            </div>
        </div>
    </div>
</div>

<!-- BLOG -->
<div class="blog-section" id="blog">
    <div class="blog-inner">
        <div class="section-hdr">
            <div><span class="section-label">Updates</span><h2 class="section-heading">Latest Posts</h2></div>
            <a href="/blog" class="btn btn-outline" style="flex-shrink:0;">All Posts</a>
        </div>
        <div class="blog-grid" id="blog-grid">
            <div style="grid-column:1/-1;background:var(--surface);padding:3rem;color:var(--muted);font-size:0.875rem;text-align:center;">Loading…</div>
        </div>
    </div>
</div>

<!-- CAREERS TEASER -->
<div class="careers-section" id="careers-preview">
    <div class="careers-inner">
        <div class="careers-hdr">
            <div><span class="section-label">Join the Team</span><h2 class="section-heading">Open Positions</h2></div>
            <a href="/careers" class="btn btn-primary" style="flex-shrink:0;">View All Roles</a>
        </div>
        <div id="home-roles-list">
            <div class="no-roles">Loading open positions…</div>
        </div>
    </div>
</div>

<!-- BLOG MODAL -->
<div class="modal" id="blog-modal">
    <div class="modal-content">
        <button class="modal-close" id="modal-close">✕</button>
        <div class="modal-header">
            <div class="modal-meta"><span id="modal-date"></span><span id="modal-readtime"></span></div>
            <h2 class="modal-title" id="modal-title"></h2>
        </div>
        <div class="modal-body" id="modal-body"></div>
    </div>
</div>

<!-- CONTACT -->
<div class="contact-section" id="contact">
    <div class="contact-inner">
        <span class="section-label">Get in Touch</span>
        <h2 class="section-heading">Contact Us</h2>
        <form id="contact-form" class="contact-form">
            <div class="form-row">
                <div class="form-group"><label>Name *</label><input type="text" id="contact-name" required placeholder="Your name"></div>
                <div class="form-group"><label>Email *</label><input type="email" id="contact-email" required placeholder="you@email.com"></div>
            </div>
            <div class="form-group"><label>Subject *</label><input type="text" id="contact-subject" required placeholder="What's this about?"></div>
            <div class="form-group"><label>Message *</label><textarea id="contact-message" rows="6" required placeholder="Tell us more…"></textarea></div>
            <div class="form-status" id="contact-status"></div>
            <button type="submit" class="btn btn-primary" style="width:100%;justify-content:center;">Send Message</button>
        </form>
    </div>
</div>

<script src="navbar.js"></script>
<script src="footer.js"></script>
<script>
    function fmt(n) {
        if (!n) return '0';
        if (n >= 1e9) return (n/1e9).toFixed(1)+'B';
        if (n >= 1e6) return (n/1e6).toFixed(1)+'M';
        if (n >= 1e3) return (n/1e3).toFixed(1)+'K';
        return n.toLocaleString();
    }
    function fmtDate(iso) { return new Date(iso).toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'}); }
    function stripHtml(html) { const d=document.createElement('div');d.innerHTML=html;return d.textContent||d.innerText||''; }
    function readTime(html) { return Math.max(1,Math.round(stripHtml(html).split(/\s+/).filter(Boolean).length/200))+' min read'; }
    function preview(html,len=120) { const t=stripHtml(html);return t.length>len?t.slice(0,len).trimEnd()+'…':t; }
    function extractFirstImg(html) { const m=html.match(/<img[^>]+src=["']([^"']+)["']/i); return m?m[1]:null; }

    async function loadGamesAndStats() {
        try {
            const {games} = await fetch('/api/games').then(r=>r.json());
            document.getElementById('games-count').textContent = games.length;
            document.getElementById('ccu-display').textContent = fmt(games.reduce((s,g)=>s+(g.playing||0),0));
            document.getElementById('visit-display').textContent = fmt(games.reduce((s,g)=>s+(g.visits||0),0));
            const f = games.find(g=>g.featured);
            if (f) {
                document.getElementById('featured-wrap').style.display = 'block';
                document.getElementById('featured-img').src = f.thumbnail||'';
                document.getElementById('featured-img').alt = f.name||'';
                document.getElementById('featured-name').textContent = f.name||'—';
                document.getElementById('featured-desc').textContent = f.description||'An immersive Roblox experience crafted by the Switch team.';
                document.getElementById('featured-playing').textContent = fmt(f.playing||0);
                document.getElementById('featured-visits').textContent = fmt(f.visits||0);
                const url = `https://www.roblox.com/games/${f.placeId||f.universeId}`;
                document.getElementById('featured-link').href = url;
                document.getElementById('featured-play-btn').href = url;
            }
        } catch(e){console.error(e);}
    }

    async function loadBlogPosts() {
        const grid = document.getElementById('blog-grid');
        try {
            const {posts} = await fetch('/api/blog/posts').then(r=>r.json());
            if (!posts?.length) { grid.innerHTML='<div style="grid-column:1/-1;background:var(--surface);padding:3rem;color:var(--muted);text-align:center;font-size:0.875rem;">No posts yet.</div>'; return; }
            grid.innerHTML = posts.slice(0,3).map(p => {
                const thumb = p.image || extractFirstImg(p.content);
                return `<div class="blog-card" onclick="openPost(${JSON.stringify(p).replace(/"/g,'&quot;')})">
                    ${thumb ? `<img src="${thumb}" class="blog-thumb" alt="${p.title}" loading="lazy">` : '<div class="blog-thumb-ph"></div>'}
                    <div class="blog-body">
                        <div class="blog-meta-row"><span class="blog-date">${fmtDate(p.createdAt)}</span><span class="blog-rt">${readTime(p.content)}</span></div>
                        <h3 class="blog-title">${p.title}</h3>
                        <p class="blog-preview">${preview(p.content)}</p>
                    </div>
                </div>`;
            }).join('');
        } catch(e) { grid.innerHTML='<div style="grid-column:1/-1;padding:2rem;color:var(--muted);">Failed to load posts.</div>'; }
    }

    async function loadOpenRoles() {
        const wrap = document.getElementById('home-roles-list');
        try {
            const {careers} = await fetch('/api/careers').then(r=>r.json());
            if (!careers?.length) { wrap.innerHTML='<div class="no-roles">No open positions right now — check back soon.</div>'; return; }
            wrap.innerHTML = `<div class="open-roles-list">${careers.slice(0,4).map(c=>`
                <a href="/careers" class="open-role-row">
                    <div>
                        <div class="open-role-title">${c.title}</div>
                        <div class="open-role-meta">
                            ${c.department?`<span class="open-role-tag dept">${c.department}</span>`:''}
                            <span class="open-role-tag">${c.type}</span>
                            <span class="open-role-tag">${c.location}</span>
                        </div>
                    </div>
                    <span class="role-arrow">→</span>
                </a>`).join('')}</div>`;
        } catch(e) { wrap.innerHTML='<div class="no-roles">Failed to load positions.</div>'; }
    }

    function openPost(p) {
        document.getElementById('modal-date').textContent = fmtDate(p.createdAt);
        document.getElementById('modal-readtime').textContent = readTime(p.content);
        document.getElementById('modal-title').textContent = p.title;
        document.getElementById('modal-body').innerHTML = p.content;
        document.getElementById('blog-modal').classList.add('open');
        document.body.style.overflow = 'hidden';
    }
    function closeModal() { document.getElementById('blog-modal').classList.remove('open'); document.body.style.overflow=''; }
    document.getElementById('modal-close').addEventListener('click', closeModal);
    document.getElementById('blog-modal').addEventListener('click', e=>{if(e.target.id==='blog-modal')closeModal();});
    document.addEventListener('keydown', e=>{if(e.key==='Escape')closeModal();});

    document.getElementById('contact-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const status = document.getElementById('contact-status');
        const btn = this.querySelector('button[type=submit]');
        btn.disabled=true; btn.textContent='Sending…';
        try {
            const res = await fetch('/api/contact',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:document.getElementById('contact-name').value,email:document.getElementById('contact-email').value,subject:document.getElementById('contact-subject').value,message:document.getElementById('contact-message').value})});
            if (res.ok) { status.textContent="Message sent. We'll get back to you shortly."; status.className='form-status success'; status.style.display='block'; this.reset(); }
            else throw new Error();
        } catch { status.textContent='Something went wrong. Please try again.'; status.className='form-status error'; status.style.display='block'; }
        finally { btn.disabled=false; btn.textContent='Send Message'; }
    });

    loadGamesAndStats();
    loadBlogPosts();
    loadOpenRoles();
</script>
</body>
</html>